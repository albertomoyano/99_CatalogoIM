name: Generar y Publicar Catálogo Completo

on:
  push:
    paths:
      - '**/*.pdf'  # Se activa con cambios en cualquier PDF
    branches:
      - main
  workflow_dispatch:  # Permite ejecución manual

jobs:
  procesar-pdfs:
    runs-on: ubuntu-latest
    
    steps:
    # Paso 1: Obtener el código
    - name: Checkout repository
      uses: actions/checkout@v4
      
    # Paso 2: Configurar Python (tu script ya funciona, solo aseguramos el entorno)
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        
    # Paso 3: Instalar EXACTAMENTE lo que tu script necesita
    - name: Install PyPDF2
      run: pip install PyPDF2
      
    # Paso 4: Ejecutar TU script combine_pdfs.py (sin modificaciones)
    - name: Combinar PDFs
      run: python combine_pdfs
      
    # Paso 5: Verificar que el PDF resultante existe
    - name: Verificar PDF generado
      run: |
        if [ ! -f "docs/catalogo_ediciones_imago_mundi.pdf" ]; then
          echo "::error::El PDF combinado no se generó correctamente"
          exit 1
        fi
        echo "✔ PDF generado correctamente"
        
    # Paso 6: Crear el release con el PDF
    - name: Crear Release
      uses: softprops/action-gh-release@v1
      with:
        name: "Catálogo Completo - $(date +'%Y-%m-%d')"
        body: "Versión consolidada generada automáticamente"
        tag_name: "v$(date +'%Y-%m-%d')"
        files: docs/catalogo_ediciones_imago_mundi.pdf