name: Generar y Publicar Cat谩logo

on:
  push:
    paths:
      - '**/*.pdf'
    branches:
      - main
  workflow_dispatch:

jobs:
  procesar-y-publicar:
    runs-on: ubuntu-latest
    timeout-minutes: 20
    
    steps:
    # Paso 1: Obtener el c贸digo
    - name: Checkout repository
      uses: actions/checkout@v4
      
    # Paso 2: Configurar Python
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        
    # Paso 3: Instalar dependencias
    - name: Install dependencies
      run: pip install PyPDF2
      
    # Paso 4: Ejecutar script desde su ubicaci贸n correcta
    - name: Combinar PDFs
      id: combine
      run: |
        echo "Ejecutando script desde ./github/scripts/combine_pdfs.py"
        python ./github/scripts/combine_pdfs.py
        
        # Verificar que el PDF se gener贸
        if [ ! -f "docs/catalogo_ediciones_imago_mundi.pdf" ]; then
          echo "::error::El PDF no se gener贸 en la ubicaci贸n esperada"
          exit 1
        fi
        
        echo "PDF_PATH=docs/catalogo_ediciones_imago_mundi.pdf" >> $GITHUB_ENV
        echo "PDF_SIZE=$(du -h docs/catalogo_ediciones_imago_mundi.pdf | cut -f1)" >> $GITHUB_ENV
      
    # Paso 5: Esperar estabilizaci贸n
    - name: Esperar estabilizaci贸n del archivo
      run: sleep 5
      
    # Paso 6: Crear Release
    - name: Crear Release
      uses: softprops/action-gh-release@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        name: "Cat谩logo Ediciones Imago Mundi - $(date +'%d-%m-%Y')"
        body: |
           Generado autom谩ticamente el $(date +'%d/%m/%Y a las %H:%M')
           Tama帽o del archivo: ${{ env.PDF_SIZE }}
          
          Contiene todos los documentos combinados en orden cronol贸gico.
        tag_name: "release-$(date +'%Y%m%d-%H%M')"
        files: ${{ env.PDF_PATH }}
        draft: false
        prerelease: false