name: Generar y publicar PDF

on:
  push:
    branches:
      - main

jobs:
  build-and-release:
    runs-on: ubuntu-latest

    steps:
      - name: Clonar repositorio
        uses: actions/checkout@v3

      - name: Instalar dependencias necesarias
        run: |
          sudo apt-get update
          sudo apt-get install -y texlive-full

      - name: Compilar archivo principal .tex
        run: |
          latexmk -pdf -interaction=nonstopmode -shell-escape main.tex

      - name: Mover PDF compilado
        run: |
          mkdir -p release
          mv main.pdf release/ediciones-imago-mundi.pdf

      - name: Calcular tama침o del PDF
        id: pdf_size
        run: |
          SIZE=$(du -h release/ediciones-imago-mundi.pdf | cut -f1)
          echo "PDF_SIZE=$SIZE" >> $GITHUB_ENV
          echo "PDF_PATH=release/ediciones-imago-mundi.pdf" >> $GITHUB_ENV

      - name: Generar nombre y tag del Release
        run: |
          FECHA=$(date +'%d-%m-%Y')
          TAG="release-$(date +'%Y%m%d-%H%M')"
          echo "RELEASE_NAME=Cat치logo Ediciones Imago Mundi - $FECHA" >> $GITHUB_ENV
          echo "RELEASE_TAG=$TAG" >> $GITHUB_ENV

      - name: Crear Release
        uses: softprops/action-gh-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          name: ${{ env.RELEASE_NAME }}
          tag_name: ${{ env.RELEASE_TAG }}
          body: |
            游늰 Generado autom치ticamente el ${{ env.RELEASE_NAME }}
            游늯 Tama침o del archivo: ${{ env.PDF_SIZE }}

            Contiene todos los documentos combinados en orden cronol칩gico.
          files: ${{ env.PDF_PATH }}
          draft: false
          prerelease: false
