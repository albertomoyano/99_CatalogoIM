name: Generar y Publicar Cat치logo

on:
  push:
    paths:
      - '**/*.pdf'
    branches:
      - main
  workflow_dispatch:

jobs:
  procesar-y-publicar:
    runs-on: ubuntu-latest
    timeout-minutes: 20
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Verificar estructura de directorios
      run: |
        echo "Mostrando estructura de directorios:"
        ls -R

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: Install dependencies
      run: pip install PyPDF2

    - name: Ejecutar script para combinar PDFs
      run: python .github/scripts/combine_pdfs.py

    - name: Esperar estabilizaci칩n del archivo
      run: sleep 5

- name: Crear Release
  uses: softprops/action-gh-release@v1
  env:
    GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  with:
    name: "Cat치logo Ediciones Imago Mundi - $(date +'%d-%m-%Y')"
    body: |
      游늰 Generado autom치ticamente el $(date +'%d/%m/%Y a las %H:%M')
      游늯 Tama침o del archivo: ${{ env.PDF_SIZE }}
      
      Contiene todos los documentos combinados en orden cronol칩gico.
    tag_name: "release-$(date +'%Y%m%d')"  # Cambio aqu칤
    files: ${{ env.PDF_PATH }}
    draft: false
    prerelease: false
